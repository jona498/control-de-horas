<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Horas V3</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <nav class="main-nav">
        <button id="nav-calendar-btn" class="nav-btn active">Calendario</button>
        <button id="nav-summary-btn" class="nav-btn">Resumen Mensual</button>
        <button id="nav-overtime-btn" class="nav-btn">Horas Extra</button> 
        <button id="nav-settings-btn" class="nav-btn">Configuración</button>

        <button id="theme-toggle-btn" class="nav-btn" style="margin-left: auto;">Modo Oscuro</button>
    </nav>

    <div class="view-container">

        <div id="calendar-view" class="view active">
            <div class="app-container">
                <div class="calendario-container">
                    <div class="calendario-header">
                        <button id="prev-month-btn">&lt;</button>
                        <h2 id="month-year-display">Octubre 2025</h2>
                        <button id="next-month-btn">&gt;</button>
                    </div>
                    <div class="calendario-weekdays">
                        <div>Lunes</div> <div>Martes</div> <div>Miércoles</div> <div>Jueves</div> <div>Viernes</div> <div>Sábado</div> <div>Domingo</div>
                    </div>
                    <div class="calendario-grid" id="calendar-grid"></div>
                </div>
                <div class="sidebar-container">
                    <h3 id="sidebar-date-display">Selecciona un día</h3>
                    <div class="day-actions" style="display: none;">
                        <button id="set-workday-btn" class="day-action-btn workday">Laborable</button>
                        <button id="set-vacation-btn" class="day-action-btn vacation">Vacaciones</button>
                        <button id="set-holiday-btn" class="day-action-btn holiday">Festivo</button>
                    </div>
                    <div classs="task-status-container">
                        <div class="task-status">
                            <span>Horas Totales:</span>
                            <span id="total-hours-display">0.0h / 8.0h</span>
                        </div>
                        <div class="task-status remaining">
                            <span>Horas Restantes:</span>
                            <span id="remaining-hours-display">8.0h</span>
                        </div>
                        <div class="task-status unimputed">
                            <span>Horas NO Imputadas:</span>
                            <span id="unimputed-hours-display">0.0h</span>
                        </div>
                    </div>
                    
                    <button id="impute-all-btn" class="day-action-btn workday" style="margin-bottom: 15px; width: 100%; box-sizing: border-box; display: none;">Marcar todo como Imputado</button>
                    
                    <div id="task-list"></div>
                    <div class="add-task-form" style="display: none;">
                        <h4>Añadir Nueva Tarea</h4>
                        <label for="task-project-input">Proyecto</label>
                        <input type="text" id="task-project-input" list="project-suggestions" placeholder="ej: Clun, Mitel, Amtega...">
                        <datalist id="project-suggestions"></datalist>
                        <label for="task-jp-input">Jefe de Proyecto (JP)</label>
                        <input type="text" id="task-jp-input" list="jp-suggestions" placeholder="ej: Nano, Loli, Sara...">
                        <datalist id="jp-suggestions"></datalist>
                        <label for="task-name-input">Descripción de la Tarea</label>
                        <input type="text" id="task-name-input" placeholder="Descripción (opcional)">
                        <label for="task-hours-input">Horas</label>
                        <input type="number" id="task-hours-input" placeholder="Horas" step="0.5">
                        <button id="add-task-btn">Añadir Tarea</button>
                    </div>

                </div> </div>
        </div>

        <div id="summary-view" class="view">
            <h2 id="summary-title">Resumen por Fechas</h2>

            <div class="summary-controls">
                <div class="date-range-picker">
                    <label for="summary-start-date">Desde:</label>
                    <input type="date" id="summary-start-date">
                    <label for="summary-end-date">Hasta:</label>
                    <input type="date" id="summary-end-date">
                    <button id="generate-summary-btn" class="save-btn">Generar Resumen</button>
                </div>
                <button id="download-csv-btn" class="download-btn">Descargar CSV del Rango</button>
            </div>
            
            <div class="charts-container">
                <div class="chart-wrapper">
                    <h3>Horas por Proyecto</h3>
                    <canvas id="project-pie-chart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>Horas por JP</h3>
                    <canvas id="jp-pie-chart"></canvas>
                </div>
            </div>

            <h3>Desglose por Proyecto</h3>
            <div id="project-summary-container">
                </div>

            <h3>Total por Jefe de Proyecto (JP)</h3>
            <div id="jp-summary-container">
                </div>
        </div>

        <div id="settings-view" class="view">
            <h2>Configuración</h2>
            <div class="settings-section">
                <h3>Jornada Laboral</h3>
                <p>Define el número de horas de tu jornada laboral estándar.</p>
                <label for="default-hours-input">Horas de jornada por defecto:</label>
                <input type="number" id="default-hours-input" step="0.1" min="1">
                <button id="save-settings-btn" class="save-btn">Guardar Configuración</button>
            </div>
            <div class="settings-section">
                <h3>Copia de Seguridad</h3>
                <p>Guarda todos tus datos (tareas, festivos, configuración) en un archivo JSON.</p>
                <div class="backup-controls">
                    <button id="export-backup-btn" class="download-btn">Exportar Backup</button>
                    <button id="import-backup-btn" class="import-btn">Importar Backup</button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>
            <div class="settings-section">
                <h3>Administrar Sugerencias</h3>
                <p>Limpia o renombra Proyectos y JPs que hayas introducido. "Renombrar" actualizará todas las tareas existentes.</p>
                <h4>Proyectos</h4>
                <div id="project-suggestions-manager"></div>
                <h4>Jefes de Proyecto (JPs)</h4>
                <div id="jp-suggestions-manager"></div>
            </div>

            <div class="settings-section about-section">
                <h3>Acerca de</h3>
                <p class="app-version" id="app-version-trigger">Gestión de Horas v4</p>
                <p class="app-author">Programado por Jonathan Rodriguez</p>
                
                <img src="easter-egg.gif" alt="Easter Egg" id="easter-egg-image" style="display: none;">
                </div>

        </div> 

        <div id="overtime-view" class="view">
            <h2>Gestión de Horas Extra</h2>
    
            <div class="settings-section overtime-form-container">
                <h3>Añadir Horas Extra</h3>
                <form id="overtime-add-form">
                    <div class="form-grid">
                        <div>
                            <label for="overtime-date-input">Fecha</label>
                            <input type="date" id="overtime-date-input" required>
                        </div>
                        <div>
                            <label for="overtime-hours-input">Horas</label>
                            <input type="number" id="overtime-hours-input" step="0.1" min="0.1" required>
                        </div>
                        <div>
                            <label for="overtime-type-select">Tipo (según PDF)</label>
                            <select id="overtime-type-select" required>
                                <option value="A">Tipo A (Semana)</option>
                                <option value="B">Tipo B (Nocturna/Vie-Sab)</option>
                                <option value="C">Tipo C (Sab-Dom/Festivo)</option>
                            </select>
                        </div>
                        <div>
                            <label for="overtime-redemption-select">Canjear por</label>
                            <select id="overtime-redemption-select" required>
                                <option value="dinero">Dinero</option>
                                <option value="horas_libres">Horas Libres</option>
                            </select>
                        </div>
                        <div class="full-width">
                            <label for="overtime-desc-input">Descripción (Proyecto, etc.)</label>
                            <input type="text" id="overtime-desc-input" placeholder="ej: Despliegue Proyecto Clun" required>
                        </div>
                    </div>
                    <button type="submit" id="add-overtime-btn" class="save-btn">Añadir Hora Extra</button>
                </form>
            </div>
    
            <div class="settings-section overtime-summary-container">
                <h3>Resumen Pendiente de Canjear</h3>
                <div class="overtime-summary-boxes">
                    <div class="summary-box">
                        <h4>Total Dinero a Percibir</h4>
                        <span id="overtime-summary-money">0.00 €</span>
                    </div>
                    <div class="summary-box">
                        <h4>Total Horas Libres a Canjear</h4>
                        <span id="overtime-summary-free-hours">0.0 h</span>
                    </div>
                </div>
            </div>
    
            <div class="settings-section">
                <h3>Horas Pendientes de Canjear</h3>
                <div id="overtime-pending-list-container">
                    </div>
            </div>
            
            <div class="settings-section">
                <h3>Historial de Horas Canjeadas</h3>
                <div id="overtime-redeemed-list-container">
                    </div>
            </div>
        </div>

    </div>
    <script src="app.js"></script>
</body>
</html>